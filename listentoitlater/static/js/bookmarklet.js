// Bookmarklet v1 for ListenToItLater w/ Mixpanel
(function(){function h(a){$lilnotification=$("#lilnotification"),$lilnotification.html(a),$lilnotification.miniNotification({closeButton:!0,closeButtonText:"[hide]",closeButtonClass:"lilhide",innerDivClass:"lilinner"}),$lilnotification.find(".lilhide").css("margin-left","66px")}function i(){$.ajax({url:"http://listentoitlater.co/api/user/me/playlists/Favorites",type:"POST",data:JSON.stringify(a),xhrFields:{withCredentials:!0},contentType:"application/json",success:function(a){a.status==401?h('You must be logged into <a href="http://listentoitlater.co" target="_blank">ListenToItLater</a>'):(mixpanel.name_tag(a.result.username),mixpanel.identify(a.result.username+Math.round((new Date(a.result.date_registered)).getTime()/1e3)),mixpanel.track("Added track from Bookmarklet",{platform:"soundcloud",playlist:"Favorites"}),h('Added to your <a href="http://listentoitlater.co" target="_blank">ListenToItLater</a> Favorites'))},error:function(a){console.log("Failed "+a)}})}function j(){$("body").append('<div id="lilnotification" style="display: none;opacity: 0.95;top: -46px;position: fixed;cursor: pointer;width: 100%;background: #EFEFEF;text-align: center;border-top: 2px solid #FFF;z-index:9999;font-family: helvetica,,arial,sans-serif;margin: 0 auto;"></div>'),$.getJSON("http://api.soundcloud.com/resolve?url="+encodeURIComponent(d.URL)+"&format=json&consumer_key="+b+"&callback=?",function(b){var c=b.permalink_url.replace("http://soundcloud.com","");a=new g(b.title+" by "+b.user.username,"SoundCloud","http://soundcloud.com",c,b.duration,b.id,b.user_id,b.artwork_url)}).done(function(){i()})}function k(a,b){if(!window.jQuery||jQuery.fn.jquery<=c){var e=d.getElementsByTagName("head")[0],f=d.createElement("script");f.src=a;var g=!1;f.onload=f.onreadystatechange=function(){!g&&(!this.readyState||this.readyState=="loaded"||this.readyState=="complete")&&(g=!0,b(),f.onload=f.onreadystatechange=null,e.removeChild(f))},e.appendChild(f)}}var a,b="e578f3875013b41753c28af111e43c29",c="1.7.1",d=document,e=d.body,f=function(a,b){this.name=a,this.url=b},g=function(a,b,c,d,e,g,h,i){this.title=a,this.platform=new f(b,c),this.url=d,this.duration=e||0,this.recording_id=g.toString()||"01",this.platform_user_id=h.toString()||"",this.artwork_url=i||"http://assets.listentoitlater.co/img/75x75.gif"};k("http://ajax.googleapis.com/ajax/libs/jquery/"+c+"/jquery.min.js",function(){k("http://assets.listentoitlater.co/js/libs/miniNotification.min.js",function(){j(),function(a,b){window.mixpanel=b;var c,d,e,f;c=a.createElement("script"),c.type="text/javascript",c.async=!0,c.src=("https:"===a.location.protocol?"https:":"http:")+"//api.mixpanel.com/site_media/js/api/mixpanel.2.js",d=a.getElementsByTagName("script")[0],d.parentNode.insertBefore(c,d),b._i=[],b.init=function(a,c,d){function g(a,b){var c=b.split(".");2==c.length&&(a=a[c[0]],b=c[1]),a[b]=function(){a.push([b].concat(Array.prototype.slice.call(arguments,0)))}}var h=b;"undefined"!=typeof d?h=b[d]=[]:d="mixpanel",h.people=h.people||[],e=["disable","track","track_pageview","track_links","track_forms","register","register_once","unregister","identify","name_tag","set_config","people.set","people.increment"];for(f=0;f<e.length;f++)g(h,e[f]);b._i.push([a,c,d])},b.__SV=1.1}(document,window.mixpanel||[]),mixpanel.init("1878a4461ab38cbf42a75e7510a0b6e1")})})})();